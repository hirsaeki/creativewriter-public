<!doctype html>
<html lang="en" class="ion-palette-dark">
<head>
  <meta charset="utf-8">
  <title>Creativewriter2</title>
  <base href="/">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover">

  <!-- Cache Control: Prevent caching of index.html -->
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">

  <link rel="icon" type="image/x-icon" href="favicon.ico">

  <!-- Material Symbols -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />

  <!-- PouchDB bundled via ESM (see DatabaseService) -->

  <!-- Stripe.js for Pricing Table -->
  <script async src="https://js.stripe.com/v3/pricing-table.js"></script>

  <!-- Early browser compatibility check and error handling -->
  <script>
    // Detect browser and log for debugging
    (function() {
      try {
        const ua = navigator.userAgent;
        const isVivaldi = ua.includes('Vivaldi');
        const isChrome = ua.includes('Chrome');
        const chromiumVersion = ua.match(/Chrome\/(\d+)/)?.[1];

        if (isVivaldi) {
          console.log('Vivaldi browser detected, version:', chromiumVersion);
        }

        // Check for required browser features
        const requiredFeatures = {
          'IndexedDB': 'indexedDB' in window,
          'CustomElements': 'customElements' in window,
          'WebComponents': 'customElements' in window && 'attachShadow' in Element.prototype,
          'ES6': typeof Symbol !== 'undefined',
          'Promises': typeof Promise !== 'undefined',
          'Fetch': typeof fetch !== 'undefined'
        };

        let missingFeatures = [];
        for (const [feature, supported] of Object.entries(requiredFeatures)) {
          if (!supported) {
            missingFeatures.push(feature);
          }
        }

        if (missingFeatures.length > 0) {
          console.error('Missing required browser features:', missingFeatures);
          document.addEventListener('DOMContentLoaded', function() {
            document.body.innerHTML = '<div style="font-family: system-ui; padding: 20px; max-width: 600px; margin: 50px auto;">' +
              '<h1 style="color: #d32f2f;">Browser Not Supported</h1>' +
              '<p>Your browser is missing required features: ' + missingFeatures.join(', ') + '</p>' +
              '<p>Please use a modern browser like Chrome, Firefox, Safari, or Edge.</p></div>';
          });
        } else {
          console.log('All required browser features are supported');
        }
      } catch (error) {
        console.error('Browser compatibility check failed:', error);
      }
    })();
  </script>
</head>
<body class="dark">
  <app-root></app-root>
</body>
</html>
