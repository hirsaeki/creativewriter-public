<div class="proxy-settings">
  <div class="tab-header">
    <h2>
      <ion-icon name="shield-checkmark-outline"></ion-icon>
      Reverse Proxy Settings
    </h2>
    <p>Configure reverse proxy endpoints for API providers. Useful for self-hosted proxies or enterprise environments.</p>
  </div>

  <!-- Claude Proxy -->
  <ion-card>
    <ion-card-header>
      <ion-card-title>
        <ion-icon name="server-outline"></ion-icon>
        Claude API Proxy
      </ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-item lines="none">
        <ion-toggle
          [(ngModel)]="claudeConfig.enabled"
          (ionChange)="onToggleChange('claude')">
          Enable Proxy
        </ion-toggle>
      </ion-item>

      <ion-item *ngIf="claudeConfig.enabled">
        <ion-input
          label="Proxy URL"
          labelPlacement="stacked"
          placeholder="https://your-proxy.example.com"
          [(ngModel)]="claudeConfig.url"
          (ionInput)="onUrlChange('claude')"
          [class.ion-invalid]="claudeUrlError">
        </ion-input>
      </ion-item>
      <ion-note *ngIf="claudeConfig.enabled && claudeUrlError" color="danger" class="validation-error">
        {{ claudeUrlError }}
      </ion-note>

      <ion-item *ngIf="claudeConfig.enabled">
        <ion-input
          label="Auth Token (optional)"
          labelPlacement="stacked"
          type="password"
          placeholder="Bearer token for proxy authentication"
          [(ngModel)]="claudeConfig.authToken"
          (ionInput)="onSettingsChange()">
        </ion-input>
      </ion-item>

      <ion-item *ngIf="claudeConfig.enabled && claudeConfig.authToken">
        <ion-select
          label="Auth Header Type"
          labelPlacement="stacked"
          [(ngModel)]="claudeConfig.authHeaderType"
          (ionChange)="onSettingsChange()">
          <ion-select-option value="authorization">Authorization (Transparent Proxy)</ion-select-option>
          <ion-select-option value="x-proxy-auth">X-Proxy-Auth (Explicit Proxy)</ion-select-option>
        </ion-select>
      </ion-item>

      <ion-note *ngIf="claudeConfig.enabled" color="medium">
        The proxy should forward requests to https://api.anthropic.com
      </ion-note>

      <div class="test-connection-row" *ngIf="canTestClaude">
        <ion-button
          fill="outline"
          size="small"
          (click)="testConnection('claude')"
          [disabled]="isTestingProvider('claude')">
          <ion-icon name="cloud-outline" slot="start"></ion-icon>
          <ion-spinner *ngIf="isTestingProvider('claude')" name="crescent" slot="end"></ion-spinner>
          Test Connection
        </ion-button>
        <ion-icon
          *ngIf="claudeTestResult === 'success'"
          name="checkmark-circle-outline"
          color="success"
          class="test-result-icon">
        </ion-icon>
        <ion-icon
          *ngIf="claudeTestResult === 'error'"
          name="close-circle-outline"
          color="danger"
          class="test-result-icon">
        </ion-icon>
      </div>
    </ion-card-content>
  </ion-card>

  <!-- OpenRouter Proxy -->
  <ion-card>
    <ion-card-header>
      <ion-card-title>
        <ion-icon name="server-outline"></ion-icon>
        OpenRouter API Proxy
      </ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-item lines="none">
        <ion-toggle
          [(ngModel)]="openRouterConfig.enabled"
          (ionChange)="onToggleChange('openRouter')">
          Enable Proxy
        </ion-toggle>
      </ion-item>

      <ion-item *ngIf="openRouterConfig.enabled">
        <ion-input
          label="Proxy URL"
          labelPlacement="stacked"
          placeholder="https://your-proxy.example.com"
          [(ngModel)]="openRouterConfig.url"
          (ionInput)="onUrlChange('openRouter')"
          [class.ion-invalid]="openRouterUrlError">
        </ion-input>
      </ion-item>
      <ion-note *ngIf="openRouterConfig.enabled && openRouterUrlError" color="danger" class="validation-error">
        {{ openRouterUrlError }}
      </ion-note>

      <ion-item *ngIf="openRouterConfig.enabled">
        <ion-input
          label="Auth Token (optional)"
          labelPlacement="stacked"
          type="password"
          placeholder="Bearer token for proxy authentication"
          [(ngModel)]="openRouterConfig.authToken"
          (ionInput)="onSettingsChange()">
        </ion-input>
      </ion-item>

      <ion-item *ngIf="openRouterConfig.enabled && openRouterConfig.authToken">
        <ion-select
          label="Auth Header Type"
          labelPlacement="stacked"
          [(ngModel)]="openRouterConfig.authHeaderType"
          (ionChange)="onSettingsChange()">
          <ion-select-option value="authorization">Authorization (Transparent Proxy)</ion-select-option>
          <ion-select-option value="x-proxy-auth">X-Proxy-Auth (Explicit Proxy)</ion-select-option>
        </ion-select>
      </ion-item>

      <ion-note *ngIf="openRouterConfig.enabled" color="medium">
        The proxy should forward requests to https://openrouter.ai
      </ion-note>

      <div class="test-connection-row" *ngIf="canTestOpenRouter">
        <ion-button
          fill="outline"
          size="small"
          (click)="testConnection('openRouter')"
          [disabled]="isTestingProvider('openRouter')">
          <ion-icon name="cloud-outline" slot="start"></ion-icon>
          <ion-spinner *ngIf="isTestingProvider('openRouter')" name="crescent" slot="end"></ion-spinner>
          Test Connection
        </ion-button>
        <ion-icon
          *ngIf="openRouterTestResult === 'success'"
          name="checkmark-circle-outline"
          color="success"
          class="test-result-icon">
        </ion-icon>
        <ion-icon
          *ngIf="openRouterTestResult === 'error'"
          name="close-circle-outline"
          color="danger"
          class="test-result-icon">
        </ion-icon>
      </div>
    </ion-card-content>
  </ion-card>

  <!-- Google Gemini Proxy -->
  <ion-card>
    <ion-card-header>
      <ion-card-title>
        <ion-icon name="server-outline"></ion-icon>
        Google Gemini API Proxy
      </ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-item lines="none">
        <ion-toggle
          [(ngModel)]="googleGeminiConfig.enabled"
          (ionChange)="onToggleChange('googleGemini')">
          Enable Proxy
        </ion-toggle>
      </ion-item>

      <ion-item *ngIf="googleGeminiConfig.enabled">
        <ion-input
          label="Proxy URL"
          labelPlacement="stacked"
          placeholder="https://your-proxy.example.com"
          [(ngModel)]="googleGeminiConfig.url"
          (ionInput)="onUrlChange('googleGemini')"
          [class.ion-invalid]="googleGeminiUrlError">
        </ion-input>
      </ion-item>
      <ion-note *ngIf="googleGeminiConfig.enabled && googleGeminiUrlError" color="danger" class="validation-error">
        {{ googleGeminiUrlError }}
      </ion-note>

      <ion-item *ngIf="googleGeminiConfig.enabled">
        <ion-input
          label="Auth Token (optional)"
          labelPlacement="stacked"
          type="password"
          placeholder="Bearer token for proxy authentication"
          [(ngModel)]="googleGeminiConfig.authToken"
          (ionInput)="onSettingsChange()">
        </ion-input>
      </ion-item>

      <ion-item *ngIf="googleGeminiConfig.enabled && googleGeminiConfig.authToken">
        <ion-select
          label="Auth Header Type"
          labelPlacement="stacked"
          [(ngModel)]="googleGeminiConfig.authHeaderType"
          (ionChange)="onSettingsChange()">
          <ion-select-option value="authorization">Authorization (Transparent Proxy)</ion-select-option>
          <ion-select-option value="x-proxy-auth">X-Proxy-Auth (Explicit Proxy)</ion-select-option>
        </ion-select>
      </ion-item>

      <ion-note *ngIf="googleGeminiConfig.enabled" color="medium">
        The proxy should forward requests to https://generativelanguage.googleapis.com
      </ion-note>

      <div class="test-connection-row" *ngIf="canTestGoogleGemini">
        <ion-button
          fill="outline"
          size="small"
          (click)="testConnection('googleGemini')"
          [disabled]="isTestingProvider('googleGemini')">
          <ion-icon name="cloud-outline" slot="start"></ion-icon>
          <ion-spinner *ngIf="isTestingProvider('googleGemini')" name="crescent" slot="end"></ion-spinner>
          Test Connection
        </ion-button>
        <ion-icon
          *ngIf="googleGeminiTestResult === 'success'"
          name="checkmark-circle-outline"
          color="success"
          class="test-result-icon">
        </ion-icon>
        <ion-icon
          *ngIf="googleGeminiTestResult === 'error'"
          name="close-circle-outline"
          color="danger"
          class="test-result-icon">
        </ion-icon>
      </div>
    </ion-card-content>
  </ion-card>

  <!-- Ollama Auth -->
  <ion-card>
    <ion-card-header>
      <ion-card-title>
        <ion-icon name="key-outline"></ion-icon>
        Ollama Authentication
      </ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-item>
        <ion-input
          label="Auth Token (optional)"
          labelPlacement="stacked"
          type="password"
          placeholder="Bearer token for Ollama server"
          [(ngModel)]="settings.ollama!.authToken"
          (ionInput)="onSettingsChange()">
        </ion-input>
      </ion-item>

      <ion-note color="medium">
        Add authentication if your Ollama server is behind a reverse proxy with auth
      </ion-note>
    </ion-card-content>
  </ion-card>

  <!-- OpenAI Compatible Auth -->
  <ion-card>
    <ion-card-header>
      <ion-card-title>
        <ion-icon name="key-outline"></ion-icon>
        OpenAI-Compatible Authentication
      </ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-item>
        <ion-input
          label="Auth Token (optional)"
          labelPlacement="stacked"
          type="password"
          placeholder="Bearer token for OpenAI-compatible server"
          [(ngModel)]="settings.openAICompatible!.authToken"
          (ionInput)="onSettingsChange()">
        </ion-input>
      </ion-item>

      <ion-note color="medium">
        Add authentication if your OpenAI-compatible server requires Bearer token
      </ion-note>
    </ion-card-content>
  </ion-card>

  <!-- Reset Button -->
  <div class="reset-section">
    <ion-button fill="outline" color="medium" (click)="resetSettings()">
      <ion-icon name="refresh-outline" slot="start"></ion-icon>
      Reset Proxy Settings
    </ion-button>
  </div>
</div>
