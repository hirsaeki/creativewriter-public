<app-header
  title="My Stories"
  logoSrc="assets/logo-v2.png"
  [showBurgerMenu]="true"
  [burgerMenuItems]="burgerMenuItems"
  [burgerMenuFooterContent]="burgerMenuFooter"
  [rightActions]="rightActions"
  [showUserInfo]="!!currentUser"
  [userGreeting]="currentUser ? 'ðŸ‘‹ ' + (currentUser.displayName || currentUser.username) : ''"
  (burgerMenuToggle)="onBurgerMenuToggle()">
  
  <app-sync-status 
    slot="user-status" 
    [showActions]="false" 
    class="compact-sync-status" 
    *ngIf="currentUser">
  </app-sync-status>
</app-header>

<ng-template #burgerMenuFooter>
  <div class="burger-menu-footer-content">
    <div *ngIf="currentUser">
      <app-sync-status [showActions]="true" class="full-sync-status"></app-sync-status>
      <ion-button fill="clear" color="danger" (click)="logout()" class="logout-button">
        Sign Out
      </ion-button>
    </div>
    <div class="version-info">
      <ion-chip color="medium" class="version-chip">
        <ion-label>v{{ versionService.getShortVersion() }}</ion-label>
      </ion-chip>
    </div>
  </div>
</ng-template>

<ion-content [scrollEvents]="true">
  <div class="story-list-container">
  
  <!-- App Title Section -->
  <div class="app-branding">
    <h1 class="app-title">
      <span class="app-name">Creative Writer</span>
      <span class="app-tagline">Your Stories, Your World</span>
    </h1>
    <div class="brand-decoration"></div>
  </div>
  
  <div class="action-buttons">
    <ion-button expand="block" size="default" color="primary" (click)="createNewStory()">
      <ion-icon name="add" slot="start"></ion-icon>
      Write New Story
    </ion-button>
    <ion-button expand="block" size="default" fill="outline" color="medium" (click)="importNovelCrafter()">
      <ion-icon name="download" slot="start"></ion-icon>
      NovelCrafter Import
    </ion-button>
    <ion-button expand="block" size="default" fill="outline" color="secondary" (click)="goToImageGeneration()">
      <ion-icon name="images" slot="start"></ion-icon>
      Image Generation
    </ion-button>
  </div>
  
  <div class="stories-grid" *ngIf="stories.length > 0; else noStories"
       [cdkDropListDisabled]="!reorderingEnabled"
       cdkDropList
       (cdkDropListDropped)="drop($event)">
    <ion-card class="story-card"
              *ngFor="let story of stories; trackBy: trackByStoryId"
              [cdkDragDisabled]="!reorderingEnabled"
              cdkDrag
              (click)="!reorderingEnabled && openStory(story.id)"
              [class.reordering-enabled]="reorderingEnabled"
              button>
      <!-- Cover Image -->
      <div class="story-cover" *ngIf="story.coverImage">
        <img [src]="getCoverImageUrl(story)" [alt]="story.title || 'Story cover'" />
        <div class="cover-overlay"></div>
      </div>
      
      <ion-card-header [class.with-cover]="!!story.coverImage">
        <div class="card-header-content">
          <ion-button fill="clear" size="small" color="medium" 
                      class="drag-handle" 
                      [style.visibility]="reorderingEnabled ? 'visible' : 'hidden'"
                      cdkDragHandle 
                      (click)="$event.stopPropagation()">
            <ion-icon name="reorder-three" slot="icon-only"></ion-icon>
          </ion-button>
          <ion-card-title>{{ story.title || 'Untitled Story' }}</ion-card-title>
          <ion-button fill="clear" size="small" color="danger" (click)="deleteStory($event, story.id)">
            <ion-icon name="trash" slot="icon-only"></ion-icon>
          </ion-button>
        </div>
      </ion-card-header>
      <ion-card-content>
        <p class="story-preview">{{ getStoryPreview(story) }}</p>
        <div class="story-chips">
          <ion-chip color="medium">
            <span>{{ getWordCount(story) }} words</span>
          </ion-chip>
          <ion-chip color="medium">
            <span>{{ story.updatedAt | date:'short' }}</span>
          </ion-chip>
        </div>
      </ion-card-content>
    </ion-card>
  </div>
  
  <ng-template #noStories>
    <div class="no-stories">
      <ng-container *ngIf="isLoadingStories; else emptyState">
        <ion-spinner name="crescent"></ion-spinner>
        <p>Loading stories...</p>
      </ng-container>
      <ng-template #emptyState>
        <p>No stories available yet.</p>
        <p>Start writing your first story!</p>
      </ng-template>
    </div>
  </ng-template>
  
  <!-- Login Modal -->
  <app-login></app-login>
  
  <!-- Mobile FAB Button -->
  <div class="mobile-fab-container">
    <button class="mobile-fab-button" (click)="toggleFabMenu()">
      <ion-icon name="add"></ion-icon>
    </button>
    <div class="mobile-fab-menu" *ngIf="fabMenuOpen">
      <button class="mobile-fab-option" (click)="createNewStory()">
        <ion-icon name="create"></ion-icon>
        <span>New Story</span>
      </button>
      <button class="mobile-fab-option" (click)="importNovelCrafter()">
        <ion-icon name="download"></ion-icon>
        <span>Import</span>
      </button>
      <button class="mobile-fab-option" (click)="goToImageGeneration()">
        <ion-icon name="images"></ion-icon>
        <span>Images</span>
      </button>
    </div>
  </div>
  </div>
</ion-content>