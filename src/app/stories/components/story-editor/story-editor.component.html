    <ion-split-pane contentId="main-content" when="lg">
      <!-- Side Menu -->
      <ion-menu contentId="main-content" menuId="story-menu" side="start" type="push">
        <app-story-structure 
          [story]="story" 
          [activeChapterId]="activeChapterId"
          [activeSceneId]="activeSceneId"
          (sceneSelected)="onSceneSelected($event)"
          (closeSidebar)="onCloseSidebar()">
        </app-story-structure>
      </ion-menu>
      
      <!-- Main Content -->
      <div class="ion-page" id="main-content">
        <app-header
          [titleTemplate]="headerTitle"
          [leftActions]="leftActions"
          [rightActions]="rightActions"
          [showBurgerMenu]="true"
          [burgerMenuItems]="burgerMenuItems"
          [burgerMenuFooterContent]="burgerMenuFooter"
          (burgerMenuToggle)="onBurgerMenuToggle()">
        </app-header>
        
        <ng-template #headerTitle>
          <div *ngIf="activeScene" class="app-title">
            <div class="header-content">
              <div class="cover-thumbnail" *ngIf="story?.coverImage" 
                   tabindex="0"
                   role="button"
                   [attr.aria-label]="'Show cover image: ' + (story.title || 'Untitled Story')"
                   (click)="openCoverPopover($event)"
                   (keydown.enter)="openCoverPopover($event)"
                   (keydown.space)="openCoverPopover($event)">
                <img [src]="getCoverImageUrl()" [alt]="story.title || 'Story cover'" />
              </div>
              <div class="title-content">
                <div class="title-line">{{ getCurrentChapterTitle() }}</div>
                <div class="title-line">{{ getCurrentSceneTitle() }}</div>
              </div>
            </div>
          </div>
        </ng-template>
        
        <ng-template #burgerMenuFooter>
          <div class="burger-menu-status">
            <div class="status-detail">
              <ion-chip [color]="hasUnsavedChanges ? 'warning' : 'success'" class="full-status">
                <ion-icon [name]="hasUnsavedChanges ? 'save-outline' : 'checkmark-circle-outline'"></ion-icon>
                <ion-label>{{ hasUnsavedChanges ? 'Not saved' : 'Saved' }}</ion-label>
              </ion-chip>
              <ion-chip color="medium" class="full-status">
                <ion-icon name="stats-chart-outline"></ion-icon>
                <ion-label>{{ wordCount }} words</ion-label>
              </ion-chip>
              <app-version-tooltip *ngIf="versionService.getVersionSync()">
                <ion-chip color="medium" class="full-status">
                  <ion-label>{{ versionService.getShortVersion() }}</ion-label>
                </ion-chip>
              </app-version-tooltip>
            </div>
          </div>
        </ng-template>
        
        <ion-content [scrollEvents]="true">
          <!-- Phase 5: Loading overlay for story sync -->
          <div *ngIf="isLoadingStory" class="story-loading-overlay">
            <div class="loading-content">
              <ion-spinner name="crescent"></ion-spinner>
              <p class="loading-message">{{ loadingMessage }}</p>
              <div class="debug-logs" *ngIf="debugLogs.length > 0">
                <div class="debug-log" *ngFor="let log of debugLogs">{{ log }}</div>
              </div>
            </div>
          </div>

          <div class="editor-container">
            <div class="editor-main">
            <div class="editor-content" [style.--editor-text-color]="currentTextColor">
              <div class="editor-inner">
                <input 
                  type="text" 
                  class="title-input-native" 
                  placeholder="Title of your story..." 
                  [(ngModel)]="story.title"
                  (ngModelChange)="onStoryTitleChange()"
                />
                
                <div class="scene-editor" *ngIf="activeScene">
                  <!-- Scene Navigation - Top -->
                  <div class="scene-navigation top">
                    <ion-button 
                      fill="clear" 
                      size="small"
                      (click)="navigateToPreviousScene()"
                      [disabled]="!hasPreviousScene()"
                      class="nav-button prev-button"
                      [attr.aria-label]="'To previous scene'">
                      <ion-icon name="chevron-back" slot="start"></ion-icon>
                      Previous Scene
                    </ion-button>
                    
                    
                    <ion-button 
                      fill="clear" 
                      size="small"
                      (click)="navigateToNextScene()"
                      [disabled]="!hasNextScene()"
                      class="nav-button next-button"
                      [attr.aria-label]="'To next scene'">
                      Next Scene
                      <ion-icon name="chevron-forward" slot="end"></ion-icon>
                    </ion-button>
                  </div>
                  
                  <div class="scene-title-editor-container">
                    <div class="scene-id-badge" *ngIf="activeScene && activeChapterId">
                      {{ getSceneIdDisplay() }}
                    </div>
                    <input 
                      type="text" 
                      class="scene-title-input-native" 
                      placeholder="Scene title..." 
                      [(ngModel)]="activeScene.title"
                      (ngModelChange)="onSceneTitleChange()"
                    />
                  </div>
                  
                  <div class="editor-wrapper" #editorWrapper>
                    <div 
                      #editorContainer
                      class="content-editor"
                      [style.--editor-text-color]="currentTextColor"
                    ></div>
                    <button
                      *ngIf="videoButton.visible"
                      type="button"
                      class="image-video-action-button"
                      [style.top.px]="videoButton.top"
                      [style.left.px]="videoButton.left"
                      (click)="onVideoButtonClicked($event)"
                      (mouseenter)="onVideoButtonPointerEnter()"
                      (mouseleave)="onVideoButtonPointerLeave()"
                      (focus)="onVideoButtonFocus()"
                      (blur)="onVideoButtonBlur()"
                      [attr.aria-label]="videoButton.imageAlt ? 'Manage video for ' + videoButton.imageAlt : 'Manage video for image'"
                      [attr.title]="videoButton.imageAlt ? 'Manage video for ' + videoButton.imageAlt : 'Manage video'"
                    >
                      <ion-icon name="videocam-outline"></ion-icon>
                    </button>
                  </div>
                  
                  <!-- Scene Navigation - Bottom -->
                  <div class="scene-navigation bottom">
                    <ion-button 
                      fill="clear" 
                      size="small"
                      (click)="navigateToPreviousScene()"
                      [disabled]="!hasPreviousScene()"
                      class="nav-button prev-button"
                      [attr.aria-label]="'To previous scene'">
                      <ion-icon name="chevron-back" slot="start"></ion-icon>
                      Previous Scene
                    </ion-button>
                    
                    <ion-button 
                      fill="clear" 
                      size="small"
                      (click)="navigateToNextScene()"
                      [disabled]="!hasNextScene()"
                      class="nav-button next-button"
                      [attr.aria-label]="'To next scene'">
                      Next Scene
                      <ion-icon name="chevron-forward" slot="end"></ion-icon>
                    </ion-button>
                  </div>
                </div>
                
                <div class="no-scene" *ngIf="!activeScene">
                  <p>Select a scene from the structure to begin.</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </ion-content>
      
      <app-slash-command-dropdown
        *ngIf="showSlashDropdown"
        [position]="slashDropdownPosition"
        [cursorPosition]="slashCursorPosition"
        (commandSelected)="onSlashCommandSelected($event)"
        (dismissed)="hideSlashDropdown()">
      </app-slash-command-dropdown>
      
      <app-image-upload-dialog
        *ngIf="showImageDialog"
        (imageInserted)="onImageInserted($event)"
        (cancelled)="hideImageDialog()">
      </app-image-upload-dialog>

      <app-image-viewer-modal
        *ngIf="showImageViewer"
        [isOpen]="showImageViewer"
        [imageSrc]="imageViewerState.imageSrc"
        [imageAlt]="imageViewerState.imageAlt"
        [imageTitle]="imageViewerState.imageTitle"
        [videoSrc]="imageViewerState.videoSrc"
        [videoName]="imageViewerState.videoName"
        [loadingVideo]="imageViewerState.loadingVideo"
        (closed)="closeImageViewer()"
        (manageVideo)="manageVideoFromViewer()"
      ></app-image-viewer-modal>
      
      <app-video-modal
        [isVisible]="showVideoModal"
        [imageId]="currentImageId"
        (closed)="hideVideoModal()"
        (videoAssociated)="onVideoAssociated($event)">
      </app-video-modal>
      
      
      <app-story-stats
        [isOpen]="showStoryStats"
        [story]="story"
        (closed)="hideStoryStats()">
      </app-story-stats>

      <app-story-media-gallery
        [isOpen]="showMediaGallery"
        [story]="story"
        (closed)="closeMediaGallery()">
      </app-story-media-gallery>

      <app-beat-navigation-panel
        [isOpen]="showBeatNavPanel"
        [story]="story"
        [activeSceneId]="activeSceneId"
        (closed)="closeBeatNavPanel()"
        (opened)="openBeatNavPanel()"
        (beatSelected)="onBeatSelected($event)">
      </app-beat-navigation-panel>
      </div>
    </ion-split-pane>
