<div class="import-page">
  <div class="import-container">
    <div class="import-header">
      <h2>NovelCrafter Story Import</h2>
      <p>Import your NovelCrafter story including chapters, scenes, and codex entries.</p>
    </div>

    <div class="import-content">
    <!-- File Selection -->
    <div *ngIf="!isImporting() && !importResult()" class="file-selection">
      <div class="import-options">
        <!-- ZIP File Option -->
        <div class="drop-zone zip-option" 
             role="button"
             tabindex="0"
             [class.drag-over]="isDragOver()"
             (dragover)="onDragOver($event)"
             (dragleave)="onDragLeave($event)"
             (drop)="onDrop($event)"
             (click)="zipFileInput.click()"
             (keyup.enter)="zipFileInput.click()"
             (keyup.space)="zipFileInput.click()">
          <div class="drop-zone-content">
            <div class="upload-icon">üì¶</div>
            <h3>ZIP File Import</h3>
            <p>Drag and drop your NovelCrafter ZIP file here, or click to browse</p>
            <p class="file-hint">Recommended: Direct ZIP file import</p>
          </div>
        </div>

        <div class="option-separator">
          <span>oder</span>
        </div>
        
        <!-- Folder Option -->
        <div class="drop-zone folder-option" 
             role="button"
             tabindex="0"
             [class.drag-over]="isFolderDragOver()"
             (dragover)="onFolderDragOver($event)"
             (dragleave)="onFolderDragLeave($event)"
             (drop)="onFolderDrop($event)"
             (click)="folderInput.click()"
             (keyup.enter)="folderInput.click()"
             (keyup.space)="folderInput.click()">
          <div class="drop-zone-content">
            <div class="upload-icon">üìÅ</div>
            <h3>Folder Import</h3>
            <p>Select extracted NovelCrafter export folder</p>
            <p class="file-hint">Select all files from the extracted folder</p>
          </div>
        </div>
      </div>
      
      <input #zipFileInput
             type="file"
             accept=".zip"
             style="display: none"
             (change)="onZipFileSelected($event)">
             
      <input #folderInput
             type="file"
             multiple
             webkitdirectory
             style="display: none"
             (change)="onFilesSelected($event)">
    </div>

    <!-- Import Progress -->
    <div *ngIf="isImporting()" class="import-progress">
      <div class="progress-spinner"></div>
      <h3>Importing NovelCrafter Story...</h3>
      <p>{{ importStatus() }}</p>
    </div>

    <!-- Import Preview -->
    <div *ngIf="importResult() && !isImporting()" class="import-preview">
      <h3>Import Preview</h3>
      
      <div class="preview-section">
        <h4>üìñ Story Structure</h4>
        <div class="story-info">
          <p><strong>Title:</strong> {{ importResult()!.story.title }}</p>
          <p><strong>Chapters:</strong> {{ importResult()!.story.chapters.length }}</p>
          <p><strong>Total Scenes:</strong> {{ getTotalScenes() }}</p>
        </div>
        
        <div class="chapters-preview">
          <div *ngFor="let chapter of importResult()!.story.chapters" class="chapter-item">
            <h5>{{ chapter.title }} ({{ chapter.scenes.length }} scenes)</h5>
            <div class="scenes-list">
              <span *ngFor="let scene of chapter.scenes" class="scene-badge">
                {{ scene.title }}
                <span *ngIf="scene.summary" class="summary-indicator" title="Has summary">üìù</span>
              </span>
            </div>
          </div>
        </div>
      </div>

      <div class="preview-section">
        <h4>üìö Codex Entries</h4>
        <div class="codex-stats">
          <div class="stat-item">
            <span class="stat-icon">üë§</span>
            <span class="stat-label">Characters:</span>
            <span class="stat-value">{{ importResult()!.codexEntries.characters.length }}</span>
          </div>
          <div class="stat-item">
            <span class="stat-icon">üè∞</span>
            <span class="stat-label">Locations:</span>
            <span class="stat-value">{{ importResult()!.codexEntries.locations.length }}</span>
          </div>
          <div class="stat-item">
            <span class="stat-icon">‚öîÔ∏è</span>
            <span class="stat-label">Objects:</span>
            <span class="stat-value">{{ importResult()!.codexEntries.objects.length }}</span>
          </div>
          <div class="stat-item">
            <span class="stat-icon">üìù</span>
            <span class="stat-label">Notes:</span>
            <span class="stat-value">{{ importResult()!.codexEntries.other.length }}</span>
          </div>
        </div>

        <!-- Character Preview -->
        <div *ngIf="importResult()!.codexEntries.characters.length > 0" class="entries-preview">
          <h5>Characters Preview:</h5>
          <div class="entry-cards">
            <div *ngFor="let char of importResult()!.codexEntries.characters.slice(0, 3)" class="entry-card">
              <h6>{{ char.title }}</h6>
              <p class="entry-preview">{{ getContentPreview(char.content) }}</p>
              <div class="entry-meta">
                <span *ngIf="char.metadata?.['storyRole']" class="story-role-badge">
                  {{ char.metadata?.['storyRole'] }}
                </span>
                <span *ngFor="let field of getCustomFieldsSlice(char)" class="custom-field-badge">
                  {{ getFieldName(field) }}
                </span>
              </div>
            </div>
          </div>
          <p *ngIf="importResult()!.codexEntries.characters.length > 3" class="more-entries">
            +{{ importResult()!.codexEntries.characters.length - 3 }} more characters...
          </p>
        </div>
      </div>

      <!-- Warnings -->
      <div *ngIf="importResult()!.warnings.length > 0" class="warnings-section">
        <h4>‚ö†Ô∏è Import Warnings</h4>
        <div class="warnings-list">
          <div *ngFor="let warning of importResult()!.warnings" class="warning-item">
            {{ warning }}
          </div>
        </div>
      </div>

      <!-- Import Actions -->
      <div class="import-actions">
        <button class="import-btn" (click)="confirmImport()">
          Import Story
        </button>
        <button class="cancel-btn" (click)="resetImport()">
          Select Different Files
        </button>
      </div>
    </div>

    <!-- Import Success -->
    <div *ngIf="importSuccess()" class="import-success">
      <div class="success-icon">‚úÖ</div>
      <h3>Import Successful!</h3>
      <p>Your NovelCrafter story has been imported successfully.</p>
      <div class="success-actions">
        <button class="primary-btn" (click)="goToStory()">
          Open Imported Story
        </button>
        <button class="secondary-btn" (click)="goToStoryList()">
          Back to Story List
        </button>
      </div>
    </div>
  </div>
</div>
</div>