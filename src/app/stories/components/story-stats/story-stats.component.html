    <ion-modal 
      [isOpen]="isOpen" 
      (didDismiss)="onClose()"
      [showBackdrop]="true"
      [backdropDismiss]="true"
      class="story-stats-modal">
      <ng-template>
        <ion-header class="modal-header">
          <ion-toolbar>
            <ion-title>
              <div class="modal-title">
                <ion-icon name="stats-chart-outline"></ion-icon>
                Story Statistics
              </div>
            </ion-title>
            <ion-button 
              slot="end" 
              fill="clear" 
              (click)="onClose()"
              aria-label="Close"
              class="close-button">
              <ion-icon name="close" slot="icon-only"></ion-icon>
            </ion-button>
          </ion-toolbar>
        </ion-header>
        
        <ion-content 
          class="stats-content" 
          [scrollY]="true"
          [scrollEvents]="true"
          [fullscreen]="false">
          <div class="stats-container" *ngIf="statistics">
          
          <!-- Overview Stats -->
          <ion-card class="overview-card">
            <ion-card-header>
              <ion-card-title>
                <ion-icon name="stats-chart-outline"></ion-icon>
                Overview
              </ion-card-title>
            </ion-card-header>
            <ion-card-content>
              <ion-grid>
                <ion-row>
                  <ion-col size="6">
                    <div class="stat-item">
                      <div class="stat-value">{{ statistics.totalWords | number }}</div>
                      <div class="stat-label">Total Words</div>
                    </div>
                  </ion-col>
                  <ion-col size="6">
                    <div class="stat-item">
                      <div class="stat-value">{{ statistics.totalChapters }}</div>
                      <div class="stat-label">Chapters</div>
                    </div>
                  </ion-col>
                </ion-row>
                <ion-row>
                  <ion-col size="6">
                    <div class="stat-item">
                      <div class="stat-value">{{ statistics.totalScenes }}</div>
                      <div class="stat-label">Scenes</div>
                    </div>
                  </ion-col>
                  <ion-col size="6">
                    <div class="stat-item">
                      <div class="stat-value">{{ getEstimatedReadingTime() }}</div>
                      <div class="stat-label">Reading Time (Min.)</div>
                    </div>
                  </ion-col>
                </ion-row>
              </ion-grid>
            </ion-card-content>
          </ion-card>

          <!-- Average Stats -->
          <ion-card class="averages-card">
            <ion-card-header>
              <ion-card-title>
                <ion-icon name="trending-up-outline"></ion-icon>
                Average Values
              </ion-card-title>
            </ion-card-header>
            <ion-card-content>
              <ion-grid>
                <ion-row>
                  <ion-col size="6">
                    <div class="stat-item">
                      <div class="stat-value">{{ statistics.averageWordsPerChapter | number:'1.0-0' }}</div>
                      <div class="stat-label">Words per Chapter</div>
                    </div>
                  </ion-col>
                  <ion-col size="6">
                    <div class="stat-item">
                      <div class="stat-value">{{ statistics.averageWordsPerScene | number:'1.0-0' }}</div>
                      <div class="stat-label">Words per Scene</div>
                    </div>
                  </ion-col>
                </ion-row>
              </ion-grid>
            </ion-card-content>
          </ion-card>

          <!-- Chapter Extremes -->
          <ion-card class="extremes-card" *ngIf="statistics.longestChapter || statistics.shortestChapter">
            <ion-card-header>
              <ion-card-title>
                <ion-icon name="layers-outline"></ion-icon>
                Chapter Extremes
              </ion-card-title>
            </ion-card-header>
            <ion-card-content>
              <ion-item *ngIf="statistics.longestChapter" lines="none">
                <ion-icon name="trending-up-outline" slot="start" color="success"></ion-icon>
                <ion-label>
                  <h3>Longest Chapter</h3>
                  <p>{{ statistics.longestChapter.title }}</p>
                  <ion-chip color="success">{{ statistics.longestChapter.wordCount | number }} words</ion-chip>
                </ion-label>
              </ion-item>
              
              <ion-item *ngIf="statistics.shortestChapter" lines="none">
                <ion-icon name="trending-down-outline" slot="start" color="warning"></ion-icon>
                <ion-label>
                  <h3>Shortest Chapter</h3>
                  <p>{{ statistics.shortestChapter.title }}</p>
                  <ion-chip color="warning">{{ statistics.shortestChapter.wordCount | number }} words</ion-chip>
                </ion-label>
              </ion-item>
            </ion-card-content>
          </ion-card>

          <!-- Chapter Details -->
          <ion-card class="chapters-card">
            <ion-card-header>
              <ion-card-title>
                <ion-icon name="book-outline"></ion-icon>
                Chapter Details
              </ion-card-title>
            </ion-card-header>
            <ion-card-content>
              <ion-list>
                <ion-item *ngFor="let chapter of statistics.chapterCounts; trackBy: trackChapter" lines="inset">
                  <ion-label>
                    <h3>{{ chapter.chapterTitle }}</h3>
                    <p>{{ chapter.sceneCount }} scenes • Ø {{ chapter.averageWordsPerScene | number:'1.0-0' }} words/scene</p>
                  </ion-label>
                  <ion-chip 
                    slot="end" 
                    [color]="getChapterChipColor(chapter.wordCount)"
                    class="word-count-chip">
                    {{ chapter.wordCount | number }} words
                  </ion-chip>
                </ion-item>
              </ion-list>
            </ion-card-content>
          </ion-card>

          <!-- Storage Usage -->
          <ion-card class="storage-card" *ngIf="statistics?.storageUsage">
            <ion-card-header>
              <ion-card-title>
                <ion-icon name="server-outline"></ion-icon>
                Storage Usage
              </ion-card-title>
            </ion-card-header>
            <ion-card-content>
              <ion-grid>
                <ion-row>
                  <ion-col size="6">
                    <div class="stat-item">
                      <div class="stat-value">{{ statistics.storageUsage.storySizeFormatted }}</div>
                      <div class="stat-label">This Story (Total)</div>
                    </div>
                  </ion-col>
                  <ion-col size="6">
                    <div class="stat-item">
                      <div class="stat-value">{{ statistics.storageUsage.totalLocalStorageFormatted }}</div>
                      <div class="stat-label">Total localStorage</div>
                    </div>
                  </ion-col>
                </ion-row>
                <ion-row>
                  <ion-col size="4">
                    <div class="stat-item">
                      <div class="stat-value">{{ statistics.storageUsage.storyTextSizeFormatted }}</div>
                      <div class="stat-label">Text Content</div>
                    </div>
                  </ion-col>
                  <ion-col size="4">
                    <div class="stat-item">
                      <div class="stat-value">{{ statistics.storageUsage.storyImageSizeFormatted }}</div>
                      <div class="stat-label">Images</div>
                    </div>
                  </ion-col>
                  <ion-col size="4">
                    <div class="stat-item">
                      <div class="stat-value">{{ statistics.storageUsage.storyImageCount }}</div>
                      <div class="stat-label">Image Count</div>
                    </div>
                  </ion-col>
                </ion-row>
                <ion-row>
                  <ion-col size="12">
                    <div class="storage-progress">
                      <div class="storage-bar">
                        <div class="storage-fill" [style.width.%]="statistics.storageUsage.percentageUsed"></div>
                      </div>
                      <div class="storage-percentage">{{ statistics.storageUsage.percentageUsed }}% of localStorage used</div>
                    </div>
                  </ion-col>
                </ion-row>
                <ion-row *ngIf="showDetailedBreakdown">
                  <ion-col size="12">
                    <ion-button 
                      fill="outline" 
                      size="small" 
                      (click)="toggleDetailedBreakdown()"
                      class="breakdown-toggle">
                      <ion-icon name="analytics-outline" slot="start"></ion-icon>
                      Detailed Storage Analysis
                    </ion-button>
                  </ion-col>
                </ion-row>
              </ion-grid>
            </ion-card-content>
          </ion-card>

          <!-- Progress Indicator (if story has targets) -->
          <ion-card class="progress-card" *ngIf="showProgressInfo()">
            <ion-card-header>
              <ion-card-title>
                <ion-icon name="time-outline"></ion-icon>
                Progress
              </ion-card-title>
            </ion-card-header>
            <ion-card-content>
              <div class="progress-info">
                <p>Based on current length:</p>
                <ion-grid>
                  <ion-row>
                    <ion-col size="4">
                      <div class="progress-item">
                        <div class="progress-value">{{ getNovellaStatus() }}</div>
                        <div class="progress-label">Novella</div>
                      </div>
                    </ion-col>
                    <ion-col size="4">
                      <div class="progress-item">
                        <div class="progress-value">{{ getNovelStatus() }}</div>
                        <div class="progress-label">Novel</div>
                      </div>
                    </ion-col>
                    <ion-col size="4">
                      <div class="progress-item">
                        <div class="progress-value">{{ getEpicStatus() }}</div>
                        <div class="progress-label">Epic</div>
                      </div>
                    </ion-col>
                  </ion-row>
                </ion-grid>
              </div>
            </ion-card-content>
          </ion-card>

          </div>
          
          <div class="loading-state" *ngIf="!statistics">
            <p>Calculating statistics...</p>
          </div>
          
        </ion-content>
      </ng-template>
    </ion-modal>