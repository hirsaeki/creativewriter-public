# CreativeWriter Docker Compose for Unraid
#
# Installation:
# 1. Install "Docker Compose Manager" plugin from Community Applications
# 2. Go to Docker tab > "Add New Stack" > Name it "CreativeWriter"
# 3. Paste this entire file into the Compose File editor
# 4. Click "Save Changes" then "Compose Up"
# 5. Access at http://YOUR-UNRAID-IP:3080
#
# Data is stored in /mnt/user/appdata/creativewriter/
# Make sure to include this folder in your Unraid backups!

services:
  nginx:
    image: ghcr.io/marcodroll/creativewriter-public-nginx:latest
    container_name: creativewriter-nginx
    restart: unless-stopped
    ports:
      - "3080:80"  # Change 3080 to your preferred port
    depends_on:
      - creativewriter
      - couchdb
      - replicate-proxy
      - gemini-proxy
    networks:
      - creativewriter-network

  creativewriter:
    image: ghcr.io/marcodroll/creativewriter-public:latest
    container_name: creativewriter-app
    restart: unless-stopped
    environment:
      - TZ=America/New_York  # Change to your timezone
    networks:
      - creativewriter-network
    depends_on:
      - couchdb

  couchdb:
    image: ghcr.io/marcodroll/creativewriter-public-couchdb:latest
    container_name: creativewriter-couchdb
    restart: unless-stopped
    environment:
      - COUCHDB_USER=admin
      - COUCHDB_PASSWORD=CHANGE_ME_TO_SECURE_PASSWORD  # IMPORTANT: Change this!
      - COUCHDB_SECRET=CHANGE_ME_TO_SECURE_SECRET      # IMPORTANT: Change this!
    volumes:
      # Unraid standard appdata location - your stories are saved here!
      - /mnt/user/appdata/creativewriter/couchdb-data:/opt/couchdb/data
      - /mnt/user/appdata/creativewriter/couchdb-log:/opt/couchdb/var/log
    networks:
      - creativewriter-network

  replicate-proxy:
    image: ghcr.io/marcodroll/creativewriter-public-proxy:latest
    container_name: creativewriter-replicate-proxy
    restart: unless-stopped
    environment:
      - PORT=3001
    networks:
      - creativewriter-network

  gemini-proxy:
    image: ghcr.io/marcodroll/creativewriter-public-gemini-proxy:latest
    container_name: creativewriter-gemini-proxy
    restart: unless-stopped
    environment:
      - PORT=3002
    networks:
      - creativewriter-network

  snapshot-service:
    image: ghcr.io/marcodroll/creativewriter-public-snapshot-service:latest
    container_name: creativewriter-snapshot-service
    restart: unless-stopped
    environment:
      - COUCHDB_HOST=couchdb
      - COUCHDB_PORT=5984
      - COUCHDB_USER=admin
      - COUCHDB_PASSWORD=CHANGE_ME_TO_SECURE_PASSWORD  # Must match couchdb password above!
      - TZ=America/New_York  # Change to your timezone
      - LOG_LEVEL=info
      - SNAPSHOT_ENABLED=true
      - DATABASE_PATTERN=creative-writer-stories
    volumes:
      - /mnt/user/appdata/creativewriter/snapshot-log:/var/log/snapshot-service
    networks:
      - creativewriter-network
    depends_on:
      - couchdb

networks:
  creativewriter-network:
    driver: bridge
